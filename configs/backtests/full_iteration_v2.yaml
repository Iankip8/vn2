# Full Iteration v2 Backtest Configuration
# Includes all new models and improvements from the iteration plan

run_id: full_iteration_v2
description: >
  Comprehensive backtest with L=3 lead time, all new model families, and
  hypothesis validation metrics. Includes: iETS, TSB, conformal calibration,
  stockout-aware training, and SURD transforms.
created_at: "2025-12-04T00:00:00Z"
weeks: [1, 2, 3, 4, 5, 6]

paths:
  initial_state: "data/raw/Week 0 - 2024-04-08 - Initial State.csv"
  state_dir: data/states
  # Use h=3 checkpoints for L=3 optimization
  checkpoints_dir: models/checkpoints_h3
  selector_map: models/results/selector_map_seq12_v1.parquet
  # Use meta-router selector if available
  selector_overrides: models/results/selector_overrides_meta_router.csv
  output_root: reports/backtests

week_data:
  - week: 1
    state: data/states/state1.csv
  - week: 2
    state: data/states/state2.csv
  - week: 3
    state: data/states/state3.csv
  - week: 4
    state: data/states/state4.csv
  - week: 5
    state: data/states/state5.csv
  - week: 6
    state: data/states/state6.csv

strategy:
  costs:
    holding: 0.2
    shortage: 1.0
  forecast:
    sip_grain: 500
    gaussian_weight_band: [0.73, 0.93]
    gaussian_weight_sigma: 0.05
    gaussian_weight_center: 0.8333
    fold_offset: 0
    # Include all available models in the evaluation
    models:
      - zinb
      - slurp_bootstrap
      - slurp_stockout_aware
      - lightgbm_quantile
      - ets
      - croston_sba
      - seasonal_naive
      - tsb
      - iets
  allocation:
    service_bias: 0.0
    default_service_level: 0.8333
    missing_forecast_policy: zero

logging:
  level: INFO
  tag_namespace: full_iteration_v2

# Hypothesis test metrics to compute
hypothesis_metrics:
  # H1: Jensen Gap - computed automatically
  h1_enabled: true
  # H2: Stockout Awareness - compare slurp_stockout_aware vs slurp_bootstrap
  h2_enabled: true
  h2_aware_model: slurp_stockout_aware
  h2_baseline_model: slurp_bootstrap
  # H3: SURD Effect - compare slurp models vs non-transformed
  h3_enabled: true
  # H4: Lead Time - already documented separately
  h4_enabled: false

